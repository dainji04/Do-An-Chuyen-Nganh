<div class="min-h-[calc(100vh-200px)] py-10 px-5 bg-gray-100">
  <div class="max-w-6xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-10">
      <h1
        class="text-2xl md:text-3xl font-extrabold text-gray-900 flex items-center justify-center gap-3"
      >
        <span
          nz-icon
          nzType="credit-card"
          nzTheme="outline"
          class="text-3xl text-indigo-600"
        ></span>
        Thanh toán đơn hàng
      </h1>
      <p class="text-gray-500 text-sm">Vui lòng kiểm tra thông tin trước khi đặt hàng</p>
    </div>

    <div class="grid md:grid-cols-[1fr_24rem] gap-6">
      <!-- Left Section: User Info & Order Form -->
      <div class="flex flex-col gap-6">
        <!-- User Information (Disabled) -->
        <div class="bg-white rounded-xl p-6 shadow">
          <h2 class="text-lg font-semibold text-gray-900 mb-4 pb-3 border-b border-gray-100">
            Thông tin người mua
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="text-sm font-medium text-gray-700 mb-1 block">Tên đăng nhập</label>
              <input nz-input [value]="userInfo?.username || ''" disabled class="w-full" />
            </div>

            <div>
              <label class="text-sm font-medium text-gray-700 mb-1 block">Họ và tên</label>
              <input nz-input [value]="userInfo?.fullname || ''" disabled class="w-full" />
            </div>

            <div>
              <label class="text-sm font-medium text-gray-700 mb-1 block">Email</label>
              <input nz-input [value]="userInfo?.email || ''" disabled class="w-full" />
            </div>

            <div>
              <label class="text-sm font-medium text-gray-700 mb-1 block">Số điện thoại</label>
              <input nz-input [value]="userInfo?.numberphone || ''" disabled class="w-full" />
            </div>
          </div>
        </div>

        <!-- Order Form -->
        <div class="bg-white rounded-xl p-6 shadow">
          <h2 class="text-lg font-semibold text-gray-900 mb-4 pb-3 border-b border-gray-100">
            Thông tin đơn hàng
          </h2>

          <form nz-form [formGroup]="checkoutForm" class="flex flex-col gap-4">
            <!-- Address -->
            <nz-form-item>
              <nz-form-label [nzRequired]="true" class="text-sm font-medium text-gray-700">
                Địa chỉ giao hàng
              </nz-form-label>
              <nz-form-control [nzErrorTip]="addressErrorTpl">
                <textarea
                  nz-input
                  formControlName="address"
                  placeholder="Nhập địa chỉ giao hàng chi tiết"
                  [rows]="3"
                  class="w-full"
                ></textarea>
                <ng-template #addressErrorTpl let-control>
                  <ng-container *ngIf="control.hasError('required')">
                    Vui lòng nhập địa chỉ giao hàng
                  </ng-container>
                  <ng-container *ngIf="control.hasError('minlength')">
                    Địa chỉ phải có ít nhất 10 ký tự
                  </ng-container>
                  <ng-container *ngIf="control.hasError('maxlength')">
                    Địa chỉ không được quá 200 ký tự
                  </ng-container>
                </ng-template>
              </nz-form-control>
            </nz-form-item>

            <!-- Note -->
            <nz-form-item>
              <nz-form-label class="text-sm font-medium text-gray-700">
                Ghi chú (không bắt buộc)
              </nz-form-label>
              <nz-form-control [nzErrorTip]="noteErrorTpl">
                <textarea
                  nz-input
                  formControlName="note"
                  placeholder="Nhập ghi chú cho đơn hàng (nếu có)"
                  [rows]="3"
                  class="w-full"
                ></textarea>
                <ng-template #noteErrorTpl let-control>
                  <ng-container *ngIf="control.hasError('maxlength')">
                    Ghi chú không được quá 500 ký tự
                  </ng-container>
                </ng-template>
              </nz-form-control>
            </nz-form-item>

            <!-- Payment Method -->
            <div>
              <label class="text-sm font-medium text-gray-700 mb-2 block">
                Phương thức thanh toán <span class="text-red-500">*</span>
              </label>
              <nz-radio-group
                [(ngModel)]="paymentMethod"
                [ngModelOptions]="{ standalone: true }"
                style="display: flex"
              >
                <label
                  style="display: flex; justify-content: center; align-items: center"
                  nz-radio
                  nzValue="cod"
                  class="text-base"
                >
                  <span class="flex items-center gap-2">
                    <span nz-icon nzType="wallet" nzTheme="outline"></span>
                    Thanh toán khi nhận hàng (COD)
                  </span>
                </label>
                <label
                  style="display: flex; justify-content: center; align-items: center"
                  nz-radio
                  nzValue="momo"
                  class="text-base"
                >
                  <span class="flex items-center gap-2">
                    <span nz-icon nzType="mobile" nzTheme="outline"></span>
                    Thanh toán với Momo
                  </span>
                </label>
              </nz-radio-group>
            </div>
          </form>
        </div>
      </div>

      <!-- Right Section: Order Summary -->
      <div>
        <div class="bg-white rounded-xl p-6 shadow sticky top-5">
          <h2 class="text-lg font-semibold text-gray-900 mb-4 pb-3 border-b border-gray-100">
            Thông tin đơn hàng
          </h2>

          <!-- Selected Items -->
          <div class="flex flex-col gap-3 mb-4 max-h-[300px] overflow-y-auto">
            <div
              *ngFor="let item of selectedItems"
              class="flex gap-3 p-3 border border-gray-100 rounded-lg"
            >
              <div class="w-16 h-16 rounded-md overflow-hidden bg-gray-100 flex-shrink-0">
                <img
                  [src]="'/' + item.image"
                  [alt]="item.name"
                  class="w-full h-full object-cover"
                  (error)="$any($event.target).src = '/placeholder.png'"
                />
              </div>
              <div class="flex-1 min-w-0">
                <h3 class="text-sm font-semibold text-gray-900 truncate">{{ item.name }}</h3>
                <p class="text-xs text-gray-500">
                  {{ formatCurrency(item.price) }} x {{ item.quantity }}
                </p>
                <p class="text-sm font-semibold text-indigo-600 mt-1">
                  {{ formatCurrency(getItemTotal(item)) }}
                </p>
              </div>
            </div>
          </div>

          <div class="h-px bg-gray-100 my-4"></div>

          <!-- Summary -->
          <div class="flex justify-between items-center text-sm text-gray-600 mb-3">
            <span>Tạm tính:</span>
            <span class="font-semibold text-gray-900">{{ formatCurrency(getSubtotal()) }}</span>
          </div>

          <div class="flex justify-between items-center text-sm text-gray-600 mb-3">
            <span>Phí vận chuyển:</span>
            <span class="font-semibold text-gray-900">{{ formatCurrency(getShippingFee()) }}</span>
          </div>

          <div class="h-px bg-gray-100 my-4"></div>

          <div class="flex justify-between items-center text-lg font-bold text-gray-900 mb-6">
            <span>Tổng cộng:</span>
            <span class="text-2xl text-indigo-600">{{ formatCurrency(getTotal()) }}</span>
          </div>

          <!-- Action Buttons -->
          <button
            nz-button
            nzType="primary"
            nzSize="large"
            nzBlock
            class="h-12 text-lg font-semibold bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-md mb-3"
            (click)="submitOrder()"
            [nzLoading]="submitting"
            [disabled]="checkoutForm.invalid || submitting"
          >
            <span nz-icon nzType="check-circle" nzTheme="outline"></span>
            Xác nhận đặt hàng
          </button>

          <button
            nz-button
            nzSize="large"
            nzBlock
            class="h-11 border border-gray-200 rounded-md hover:border-indigo-400"
            (click)="cancel()"
            [disabled]="submitting"
          >
            <span nz-icon nzType="arrow-left" nzTheme="outline"></span>
            Quay lại giỏ hàng
          </button>

          <!-- Security Badge -->
          <div
            class="flex items-center justify-center gap-2 mt-4 pt-4 border-t border-gray-100 text-sm text-green-500"
          >
            <span nz-icon nzType="safety-certificate" nzTheme="outline"></span>
            <span>Thanh toán an toàn & bảo mật</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
